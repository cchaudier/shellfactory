#@(#)=======================================================================
#@(#)    Nom : std.lib
#@(#)    Objet : Fonctions utilitaire de base
#@(#)    Entree :  
#@(#)    Sortie : 
#@(#)    Date de creation : 21/05/14
#@(#)    Auteur : Christophe Chaudier www.cchaudier.fr
#@(#)    Commentaires :
#@(#)======================================================================

# sflib_std_init
# Test et initialise les Variables
# USAGE : sflib_std_init
# ----------------------------------------------
sflib_std_init() {
sflib_log_debug "DEBUT fct sflib_std_init()"
sflib_std_v_extSum=".sum"
sflib_std_v_extGzip=".gz"
sflib_std_v_ficConf=""

#CC : On choisi le awk en fonction du systeme
OS=$(uname)
case ${OS} in 
  AIX|HP-UX|Linux|OSF1) cmd_awk="awk" ;;
  SunOS) cmd_awk="nawk" ;;
  *)
    echo "OS non pris en Compte"
    cmd_awk="awk"
  ;;
  esac
  alias awk=$cmd_awk
  sflib_log_debug "FIN fct sflib_std_init()"
}

# sflib_std_sortie
# USAGE : sflib_std_sortie
# ----------------------------------------------
sflib_std_sortie() {
sflib_log_debug "DEBUT fct sflib_std_sortie()"
sflib_log_debug "FIN fct sflib_std_sortie()"
}

# sflib_std_test_returncode
# Fonction qui test le code retour d'une commande, si celle-ci est en erreur on affiche le message passé en parametre et on sort du script grace a la fonction sortie
# USAGE : sflib_std_test_returncode "Message à afficher si le code retour est incorrecte"
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
sflib_std_test_returncode() {
RC=$?
msgRC=$1

sflib_log_debug "DEBUT fct sflib_std_testRC()"
if [[ $RC -ne 0 ]]; then
  SEVERITE=202
  erreur "$msgRC"
  sortie
fi
sflib_log_debug "FIN fct sflib_std_testRC()"
}

# sflib_std_rep_create
# Création du répertoire s'il n'existe pas
# USAGE : sflib_std_rep_create <répertoire> [droit]
sflib_std_rep_create() {
  rep_a_creer=$1
  if [[ $# -eq 2 ]]; then
    droits=$2
  else
    droits=770
  fi

sflib_log_debug "DEBUT fct sflib_std_rep_create() [$rep_a_creer]"
  sflib_std_rep_existe $rep_a_creer
  if [[ $? -ne 0 ]]; then
    #On crée le répertoire en profondeur
    mkdir -p ${rep_a_creer}
    sflib_std_test_returncode "Création du répèrtoire ${rep_a_creer} impossible"
    chmod $droits ${rep_a_creer}
    sflib_std_test_returncode "Changement des droits[$droits] du répèrtoire ${rep_a_creer} impossible"
sflib_log_debug "Répertoire [$rep_a_creer] créé"        
  fi
sflib_log_debug "FIN fct sflib_std_rep_create()"
}

# test l'existance du répertoire
# Si le répertoire existe la fonction retourne 0 sinon elle retourne 1
# USAGE : sflib_std_rep_existe <répertoire>
sflib_std_rep_existe() {
    rep_a_tester=$1
sflib_log_debug "DEBUT fct sflib_std_rep_existe()"
    retour=0
    if [[ ! -d ${rep_a_tester} ]]; then
sflib_log_debug "Le répertoire <${rep_a_tester}> n'existe pas !"    
    retour=1
    fi
sflib_log_debug "FIN fct sflib_std_rep_existe()"
return $retour
}
